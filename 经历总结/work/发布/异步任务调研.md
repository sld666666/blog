
# 异步任务调研

## 背景
很多场景下需要对请求的任务进行延迟处理，如excel上次宝贝，提交了任务后台默默去跑。对此一个异步任务系统是非常有必要的。

## 目标

对于此异步任务系统，有几点要求

1. 高性能
2. 可追述：任务是哪台机器发起的，被哪台机器执行，是执行中还是已完成。是成功还是失败
3. 可重试： 失败重试
4. 可重发： 可以手动重发
5. 优先级： 有任务优先级，并且同一类型的任务有顺序
6. 可定时： 可以定时执行任务
6. 后台管理：有后台管理系统观察任务状态，控制人物的执行速度

## 技术选项

### MQ为基础

1. 技术要点： 以MQ为基础，搭建自己的的异步任务系统。 
2. 优点： 满足高性能， 可追述，可重试要求
3. 缺点： 无法直接支持优先级，可定时，后台管理的需求， 改造成本高

### pinlater

1. 技术要点： 直接使用pinlater
2. 优点： 基本满足我们的所有要求
3. 缺点： 其依赖的技术都是twitter的底层技术，和淘系的相差大，以后维护和改造成本高

### SchedulerX

1. 技术要点： 使用集团的中间件： SchedulerX
2. 优点： 基本能满足要求
3. 缺点： 内部用消息，需要依赖额外的服务器。 无任务优先级。 后台管理系统不能定制

### quartz

1. 技术要点： TOC使用的方案， 使用quartz作为底层任务调度引擎，写上次的实现和应用
2. 优点： quartz作为一个通用的的job scheduler其通用性、易用性和性能基本经受了时间的考验。自带存储的实现，在方案上和GSP的异步方案一直，可以有效的保证一致性。基本能满足我们前面列出的要求，依赖少
3. 缺点： 需要自己定制后台管理系统和分布式系统中的调度实现
4. 分布式的调度看[这里](https://github.com/pzxwhc/MineKnowContainer/issues/37)
