# 开放平台设计和实现
## 1 背景
为了对接各种第三方系统，一定要开发出各种对外的API来帮助系统的对接。设计一个开放平台来对接是一个具有业界通用性的解决方案。

## 2 业务架构图
一个理想的开放平台承接起内部业务系统和外部第三方调用的桥接的功能。所以其设计原则上应该不包含业务。

![开放平台和业务系统的关系](https://img.alicdn.com/imgextra/i3/46754672/TB2wxfStl8lpuFjy0FnXXcZyXXa_!!46754672.png)

从狭义上讲开放平台可以任务是一个gateway，但是作为一个完整的系统，开放平台必须包含如下几个部分：

- 后台管理系统
- 文档中心
- 登录授权
- 执行系统
- 自动化测试平台
- 安全管理
- 对外SDK

![业务架构图](https://img.alicdn.com/imgextra/i3/46754672/TB2nEfZwYlmpuFjSZFlXXbdQXXa_!!46754672.png)

下面逐一介绍各个部分的功能。

### 2.1 后台管理系统
承接其开发平台的管理、监控、统计的功能。

- API 管理： 对外API的注册，安全校验，责任人等
- API 监控： 执行系统性能， API时长， QPS等
- API 统计： 报表，API健康度，调用次数
- 运营管理

### 2.2 文档中心
保存对外的文档， 主要包含 API使用，demo

### 2.3 登录授权
- appkey + appSecret
- 授权管理
- APP 权限

### 2.4 执行系统
平台代码运行系统，最核心的代码和功能运行在该系统中。 设计原则：

- 作为以后第三方开放的唯一出口
- 定位为 gateway，原则上只做中转动而不承接业务
- 异步化：提高吞吐量，加大控制管理，慢API 不会引起开发平台的部位的
- 协议(支持json+xml)，服务注册，API接入

### 2.5 自动化测试平台
建立API测试平台保证业务和系统的问题

### 2.6 安全管理
开放平台的安全部分

- 防攻击
- api 滥用
- appkey 滥用
- appscecrt 泄露
- 数据安全 


### 2.7 对外SDK
提供对外的sdk共第三方使用。 

- java
- .net
- cpp
- javascript
- python

## 3 系统架构图架构

![开放平台系统架构图](https://img.alicdn.com/imgextra/i3/46754672/TB2nfTuw.lnpuFjSZFjXXXTaVXa_!!46754672.png)

整个系统最核心的也是最紧急的部分是网管层和服务接入层。

### 3.1 一次典型的请求流程
![一次典型的调用流程图](https://img.alicdn.com/imgextra/i4/46754672/TB2Jrr.w5pnpuFjSZFkXXc4ZpXa_!!46754672.png)

整个调用链路中，关键部分基本落在执行系统中

### 3.2 执行系统的设计
如前面所说， 执行系统从狭义上讲可以认为是一个典型的gateway，但是在调度之前必须做各种权限的检验。在整个系统中最重要的是两个部分：

- 身份验证： 详情见 《开放平台登录授权》
- 调度服务： 在技术选型上选择用spring cloud Zuul 作为底层的实现。Zuul提供了动态路由、监控、回退、安全等功能可以非常快捷的搭出我们的调度系统。

## 4 实现
...
